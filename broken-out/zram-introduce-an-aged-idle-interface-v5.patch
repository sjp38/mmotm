From: Brian Geffon <bgeffon@google.com>
Subject: zram-introduce-an-aged-idle-interface-v5

use IS_ENABLED and cleanup comment

Link: https://lkml.kernel.org/r/20210924161128.1508015-1-bgeffon@google.com
Signed-off-by: Brian Geffon <bgeffon@google.com>
Acked-by: Minchan Kim <minchan@kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
---

 drivers/block/zram/zram_drv.c |   13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

--- a/drivers/block/zram/zram_drv.c~zram-introduce-an-aged-idle-interface-v5
+++ a/drivers/block/zram/zram_drv.c
@@ -294,7 +294,7 @@ static ssize_t mem_used_max_store(struct
 /*
  * Mark all pages which are older than or equal to cutoff as IDLE.
  * Callers should hold the zram init lock in read mode
- **/
+ */
 static void mark_idle(struct zram *zram, ktime_t cutoff)
 {
 	int is_idle = 1;
@@ -310,7 +310,7 @@ static void mark_idle(struct zram *zram,
 		if (zram_allocated(zram, index) &&
 				!zram_test_flag(zram, index, ZRAM_UNDER_WB)) {
 #ifdef CONFIG_ZRAM_MEMORY_TRACKING
-			is_idle = (!cutoff || ktime_after(cutoff, zram->table[index].ac_time));
+				is_idle = (!cutoff || ktime_after(cutoff, zram->table[index].ac_time));
 #endif
 			if (is_idle)
 				zram_set_flag(zram, index, ZRAM_IDLE);
@@ -327,14 +327,15 @@ static ssize_t idle_store(struct device
 	ssize_t rv = -EINVAL;
 
 	if (!sysfs_streq(buf, "all")) {
-#ifdef CONFIG_ZRAM_MEMORY_TRACKING
+		/*
+		 * If it did not parse as 'all' try to treat it as an integer when
+		 * we have memory tracking enabled.
+		 */
 		u64 age_sec;
-		/* If it did not parse as 'all' try to treat it as an integer */
-		if (!kstrtoull(buf, 0, &age_sec))
+		if (IS_ENABLED(CONFIG_ZRAM_MEMORY_TRACKING) && !kstrtoull(buf, 0, &age_sec))
 			cutoff_time = ktime_sub(ktime_get_boottime(),
 					ns_to_ktime(age_sec * NSEC_PER_SEC));
 		else
-#endif
 			goto out;
 	}
 
_
